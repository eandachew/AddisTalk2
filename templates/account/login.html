{% extends "base.html" %}
{% load static %}

{% block head_title %}{% trans "Sign In" %}{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <!-- Back to Home -->
            <div class="mb-4">
                <a href="{% url 'home' %}" class="btn btn-outline-secondary">
                    <i class="bi bi-arrow-left me-1"></i> Back to Home
                </a>
            </div>

            <!-- Login Card -->
            <div class="card shadow-lg">
                <div class="card-body p-4 p-md-5">
                    <!-- Header -->
                    <div class="text-center mb-5">
                        <div class="mb-4">
                            <i class="bi bi-chat-dots-fill display-1 text-primary"></i>
                        </div>
                        <h1 class="display-6 fw-bold text-primary">
                            {% trans "Welcome to AddisTalk" %}
                        </h1>
                        <p class="lead text-muted">
                            {% trans "Join the conversation" %}
                        </p>
                    </div>

                    <!-- Social Login (if enabled) -->
                    {% get_providers as socialaccount_providers %}
                    
                    {% if socialaccount_providers %}
                    <div class="mb-5">
                        <p class="text-center mb-3">
                            {% blocktrans with site.name as site_name %}
                            Please sign in with one of your existing third party accounts. Or, 
                            <a href="{{ signup_url }}" class="text-decoration-none">sign up</a>
                            for a {{ site_name }} account and sign in below:
                            {% endblocktrans %}
                        </p>
                        
                        <div class="socialaccount_ballot">
                            <ul class="socialaccount_providers list-unstyled text-center">
                                {% include "socialaccount/snippets/provider_list.html" with process="login" %}
                            </ul>
                            
                            <div class="login-or text-center my-4">
                                <span class="bg-white px-3 text-muted">{% trans 'or' %}</span>
                            </div>
                        </div>
                        
                        {% include "socialaccount/snippets/login_extra.html" %}
                    </div>
                    {% else %}
                    <!-- Sign Up Prompt -->
                    <div class="alert alert-info mb-5">
                        <div class="d-flex align-items-center">
                            <i class="bi bi-info-circle-fill fs-5 me-3"></i>
                            <div>
                                {% blocktrans %}
                                If you have not created an account yet, then please
                                <a href="{{ signup_url }}" class="alert-link">sign up</a> first.
                                {% endblocktrans %}
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    <!-- Login Form -->
                    <div class="card border-0 bg-light">
                        <div class="card-body p-4">
                            <h3 class="card-title text-center mb-4">
                                <i class="bi bi-box-arrow-in-right me-2"></i>
                                {% trans "Sign In" %}
                            </h3>
                            
                            {% if form.errors %}
                            <div class="alert alert-danger alert-dismissible fade show mb-4" role="alert">
                                <div class="d-flex align-items-center">
                                    <i class="bi bi-exclamation-triangle-fill me-3 fs-5"></i>
                                    <div>
                                        <strong>{% trans "Login Failed" %}</strong>
                                        <p class="mb-0">{% trans "Your username and password didn't match. Please try again." %}</p>
                                    </div>
                                </div>
                                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                            </div>
                            {% endif %}
                            
                            <form class="login" method="POST" action="{% url 'account_login' %}">
                                {% csrf_token %}
                                
                                <!-- Username/Email Field -->
                                <div class="mb-4">
                                    <label for="id_login" class="form-label">
                                        <i class="bi bi-person me-1"></i>
                                        {% trans "Username or Email" %} *
                                    </label>
                                    <input type="text" 
                                           name="login" 
                                           id="id_login" 
                                           class="form-control form-control-lg"
                                           placeholder="{% trans 'Enter your username or email' %}"
                                           required
                                           autofocus
                                           autocomplete="username">
                                    {% if form.login.errors %}
                                    <div class="text-danger small mt-1">
                                        {{ form.login.errors }}
                                    </div>
                                    {% endif %}
                                </div>
                                
                                <!-- Password Field -->
                                <div class="mb-4">
                                    <label for="id_password" class="form-label">
                                        <i class="bi bi-lock me-1"></i>
                                        {% trans "Password" %} *
                                    </label>
                                    <input type="password" 
                                           name="password" 
                                           id="id_password" 
                                           class="form-control form-control-lg"
                                           placeholder="{% trans 'Enter your password' %}"
                                           required
                                           autocomplete="current-password">
                                    {% if form.password.errors %}
                                    <div class="text-danger small mt-1">
                                        {{ form.password.errors }}
                                    </div>
                                    {% endif %}
                                    
                                    <div class="mt-2 text-end">
                                        <a class="text-decoration-none small" href="{% url 'account_reset_password' %}">
                                            <i class="bi bi-key me-1"></i>
                                            {% trans "Forgot Password?" %}
                                        </a>
                                    </div>
                                </div>
                                
                                <!-- Remember Me -->
                                <div class="mb-4">
                                    <div class="form-check">
                                        <input class="form-check-input" 
                                               type="checkbox" 
                                               name="remember" 
                                               id="id_remember">
                                        <label class="form-check-label" for="id_remember">
                                            <i class="bi bi-check-circle me-1"></i>
                                            {% trans "Remember me" %}
                                        </label>
                                    </div>
                                </div>
                                
                                <!-- Hidden redirect field -->
                                {% if redirect_field_value %}
                                <input type="hidden" name="{{ redirect_field_name }}" value="{{ redirect_field_value }}">
                                {% endif %}
                                
                                <!-- Submit Button -->
                                <div class="d-grid mb-4">
                                    <button class="btn btn-primary btn-lg primaryAction" type="submit">
                                        <i class="bi bi-box-arrow-in-right me-2"></i>
                                        {% trans "Sign In" %}
                                    </button>
                                </div>
                                
                                <!-- Sign Up Link -->
                                <div class="text-center">
                                    <p class="text-muted mb-0">
                                        {% trans "Don't have an account?" %}
                                        <a href="{% url 'account_signup' %}" class="text-decoration-none fw-bold">
                                            {% trans "Sign up here" %}
                                        </a>
                                    </p>
                                </div>
                            </form>
                        </div>
                    </div>
                    
                    <!-- Additional Information -->
                    <div class="mt-5 pt-4 border-top">
                        <div class="row">
                            <div class="col-md-6 mb-3 mb-md-0">
                                <h5 class="mb-3">
                                    <i class="bi bi-shield-check me-2"></i>
                                    {% trans "Secure Login" %}
                                </h5>
                                <p class="text-muted small mb-0">
                                    {% trans "Your login information is encrypted and secure." %}
                                </p>
                            </div>
                            <div class="col-md-6">
                                <h5 class="mb-3">
                                    <i class="bi bi-question-circle me-2"></i>
                                    {% trans "Need Help?" %}
                                </h5>
                                <p class="text-muted small mb-0">
                                    {% trans "Having trouble logging in?" %}
                                    <a href="{% url 'contact' %}" class="text-decoration-none">{% trans "Contact support" %}</a>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Back to Home Bottom -->
            <div class="text-center mt-4">
                <a href="{% url 'home' %}" class="btn btn-outline-secondary">
                    <i class="bi bi-house-door me-2"></i>
                    {% trans "Return to Homepage" %}
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}